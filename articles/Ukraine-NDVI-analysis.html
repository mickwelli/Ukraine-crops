<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="UkraineCrops">
<title>Ukraine NDVI Analysis • UkraineCrops</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ukraine NDVI Analysis">
<meta property="og:description" content="UkraineCrops">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">UkraineCrops</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Ukraine-NDVI-analysis.html">Ukraine NDVI Analysis</a>
    <a class="dropdown-item" href="../articles/Ukraine_fire_analysis.html">Ukraine Fire Analysis</a>
    <a class="dropdown-item" href="../articles/Ukraine_ship_analysis.html">Ukraine Ship Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Ukraine NDVI Analysis</h1>
                        <h4 data-toc-skip class="author">Michael
Wellington, Roger Lawes and Petra Kuhnert</h4>
            
            <h4 data-toc-skip class="date">4 August 2022</h4>
      
      
      <div class="d-none name"><code>Ukraine-NDVI-analysis.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>The following script accompanies the paper by Wellington et
al. (2022) that explores crop growth, grain exports and fire patterns in
Ukraine. This first vignette focuses on trends in crop growth using
NDVI.</p>
</div>
<div class="section level3">
<h3 id="trend-analysis">Trend Analysis<a class="anchor" aria-label="anchor" href="#trend-analysis"></a>
</h3>
</div>
<div class="section level2">
<h2 id="reading-in-relevant-datasets">Reading in relevant datasets<a class="anchor" aria-label="anchor" href="#reading-in-relevant-datasets"></a>
</h2>
<p>We load in NDVI data clipped to Ukraine and load in the relevant
shape file. These datasets are also available in the <code>/data</code>
and <code>/inst/extdata</code> directories and can be read in using the
<code>readRDS</code> and <code>st_read</code> commands respectively.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mickwelli.github.io/Ukraine-crops/" class="external-link">UkraineCrops</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">NDVI_mod_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Ukr_bnds</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-pre-and-post-invasion-term">Creating a pre and post-invasion term<a class="anchor" aria-label="anchor" href="#creating-a-pre-and-post-invasion-term"></a>
</h2>
<p>The <code>NDVI_mod_df</code> includes a war term for pre and post
2022 calendar years but we also need to create a pre and post-invasion
term reflected by the date of the invasion (24th of February 2022).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Allocate factor for invasion</span></span>
<span><span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu">if_else</span><span class="op">(</span><span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">date</span> <span class="op">&lt;</span> <span class="st">'2022-02-24'</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-the-generalised-additive-model-gam">Fitting the Generalised Additive Model (GAM)<a class="anchor" aria-label="anchor" href="#fitting-the-generalised-additive-model-gam"></a>
</h2>
<p>We fit a Generalised Additive Model (GAM) (Wood 2006) assuming a
Gaussian distribution for the response variable, NDVI and include smooth
terms for year, season, space and relevant interactions, which consist
of season within year, and space and time.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting up the GAM structure with key smoothers for trend terms</span></span>
<span><span class="va">all_f</span> <span class="op">&lt;-</span> <span class="va">NDVI</span> <span class="op">~</span>  </span>
<span>  <span class="co"># smooth term for year</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">year</span>, bs<span class="op">=</span><span class="st">"cr"</span>, k<span class="op">=</span><span class="fl">11</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># cyclic term for season</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">month</span>, bs<span class="op">=</span><span class="st">"cc"</span>, k<span class="op">=</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># smooth term for space</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, bs<span class="op">=</span><span class="st">'gp'</span>, k<span class="op">=</span><span class="fl">50</span><span class="op">)</span>  <span class="op">+</span>            </span>
<span>  <span class="co"># seasonal within year</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">year</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cc"</span>, <span class="st">"cr"</span><span class="op">)</span>, k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>,<span class="fl">11</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># space x time</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">year</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gp"</span>, <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>     k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">11</span><span class="op">)</span>, m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p>We then add in the factor <code>inv</code> which allows us to
investigate a pre and post invasion effect.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting up the GAM structure with an added term reflecting</span></span>
<span><span class="co"># the start of the invasion</span></span>
<span><span class="va">all_f_inv</span> <span class="op">&lt;-</span> <span class="va">NDVI</span> <span class="op">~</span>  </span>
<span>  <span class="co"># factor for pre/ post-invasion</span></span>
<span>  <span class="va">inv</span> <span class="op">+</span> </span>
<span>  <span class="co"># cyclic term for season</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">month</span>, bs<span class="op">=</span><span class="st">"cc"</span>, k<span class="op">=</span><span class="fl">12</span>, by<span class="op">=</span><span class="va">inv</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># smooth term for space</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, bs<span class="op">=</span><span class="st">'gp'</span>, k<span class="op">=</span><span class="fl">50</span>, by<span class="op">=</span><span class="va">inv</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># space x time</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">month</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gp"</span>, <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>     k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">12</span><span class="op">)</span>, m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span>, by<span class="op">=</span><span class="va">inv</span><span class="op">)</span>  </span></code></pre></div>
<p>We also explore a GAM structure that fits a term reflecting the pre
(2012-21) and post war (2022) periods. This term which we refer to as
<code>war</code> represents a binary variable where 1 indicates year
2022 when the war began.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_f_war</span> <span class="op">&lt;-</span> <span class="va">NDVI</span> <span class="op">~</span>  </span>
<span>  <span class="co"># factor for pre/ post-2022</span></span>
<span>  <span class="va">war</span> <span class="op">+</span> </span>
<span>  <span class="co"># cyclic term for season</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">month</span>, bs<span class="op">=</span><span class="st">"cc"</span>, k<span class="op">=</span><span class="fl">12</span>, by<span class="op">=</span><span class="va">war</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># smooth term for space</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, bs<span class="op">=</span><span class="st">'gp'</span>, k<span class="op">=</span><span class="fl">50</span>, by<span class="op">=</span><span class="va">war</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># space x time</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">month</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gp"</span>, <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>     k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">12</span><span class="op">)</span>, m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span>, by<span class="op">=</span><span class="va">war</span><span class="op">)</span> </span></code></pre></div>
<p>We now fit each model using the <code>mgcv</code> package in
<code>R</code> and store the results. To accommodate temporal
dependencies we fit a correlation term in each model that was the result
of an iterative process as outlined in Wood et al. (2017). The final
model fits are presented here. Each model takes a few minutes to
run.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run GAMs for large datasets</span></span>
<span><span class="va">all_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></span><span class="op">(</span><span class="va">all_f</span>, data<span class="op">=</span><span class="va">NDVI_mod_df</span>, discrete<span class="op">=</span><span class="cn">TRUE</span>, nthreads<span class="op">=</span><span class="fl">8</span>, rho<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">all_gam_war</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></span><span class="op">(</span><span class="va">all_f_war</span>, data<span class="op">=</span><span class="va">NDVI_mod_df</span>, discrete<span class="op">=</span><span class="cn">TRUE</span>, nthreads<span class="op">=</span><span class="fl">8</span>, rho<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="va">all_gam_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></span><span class="op">(</span><span class="va">all_f_inv</span>, data<span class="op">=</span><span class="va">NDVI_mod_df</span>, discrete<span class="op">=</span><span class="cn">TRUE</span>, nthreads<span class="op">=</span><span class="fl">8</span>, rho<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Output shows effect of the invasion on cropland NDVI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">all_gam_inv</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: gaussian </span></span>
<span><span class="co">## Link function: identity </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## NDVI ~ inv + s(month, bs = "cc", k = 12, by = inv) + s(x, y, </span></span>
<span><span class="co">##     bs = "gp", k = 50, by = inv) + ti(x, y, month, d = c(2, 1), </span></span>
<span><span class="co">##     bs = c("gp", "cr"), k = c(50, 12), m = list(2, NA), by = inv)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error  t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept) 4378.975      2.932 1493.446   &lt;2e-16 ***</span></span>
<span><span class="co">## inv1         -11.099    982.597   -0.011    0.991    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                        edf Ref.df         F  p-value    </span></span>
<span><span class="co">## s(month):inv0        9.990  10.00 33993.699  &lt; 2e-16 ***</span></span>
<span><span class="co">## s(month):inv1        2.983   4.00  1617.662  &lt; 2e-16 ***</span></span>
<span><span class="co">## s(x,y):inv0         48.260  48.83  1412.879  &lt; 2e-16 ***</span></span>
<span><span class="co">## s(x,y):inv1         33.003  36.09     1.967 0.000487 ***</span></span>
<span><span class="co">## ti(month,x,y):inv0 376.214 429.05   127.888  &lt; 2e-16 ***</span></span>
<span><span class="co">## ti(month,x,y):inv1  55.979  72.09     8.046  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.716   Deviance explained = 71.6%</span></span>
<span><span class="co">## fREML = 3.0937e+06  Scale est. = 7.7897e+05  n = 387617</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model-checking">Model Checking<a class="anchor" aria-label="anchor" href="#model-checking"></a>
</h2>
<p>We examine the fit of the model and check for temporal and spatial
autocorrelation in the residuals. These diagnostics are examined below
and sufficiently account for correlation in the data with the given
model structure.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Temporal autocorrelation plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/check_resid.html" class="external-link">check_resid</a></span><span class="op">(</span><span class="va">all_gam</span>, ask<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ukraine-NDVI-analysis_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"><img src="Ukraine-NDVI-analysis_files/figure-html/unnamed-chunk-7-2.png" width="768" style="display: block; margin: auto;"><img src="Ukraine-NDVI-analysis_files/figure-html/unnamed-chunk-7-3.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variogram for spatial autocorrelation</span></span>
<span><span class="va">resids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/residuals.gam.html" class="external-link">residuals.gam</a></span><span class="op">(</span><span class="va">all_gam</span><span class="op">)</span></span>
<span><span class="va">data_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>resids <span class="op">=</span> <span class="va">resids</span>, long <span class="op">=</span> <span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">x</span>, lat <span class="op">=</span> <span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">data_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">long</span><span class="op">+</span><span class="va">lat</span></span>
<span><span class="co"># Select a sample for compute efficiency  </span></span>
<span><span class="va">var_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/variogram.html" class="external-link">variogram</a></span> <span class="op">(</span><span class="va">resids</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">data_pred</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_pred</span><span class="op">)</span>, <span class="fl">10000</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ukraine-NDVI-analysis_files/figure-html/unnamed-chunk-7-4.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="investigating-key-trends">Investigating Key Trends<a class="anchor" aria-label="anchor" href="#investigating-key-trends"></a>
</h2>
<p>We obtain NDVI predictions for the model and produce maps comparing
the baseline period 2012-2021 (top row) with 2022 (bottom row) as per
Figure 2 in Wellington et al. (2022). (Note this takes a few minutes to
run)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get predictions for plotting</span></span>
<span><span class="va">all_gam_war_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">all_gam_war</span>, se<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_gam_war_pred_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="va">all_gam_war_pred</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>                                  pred_se <span class="op">=</span> <span class="va">all_gam_war_pred</span><span class="op">$</span><span class="va">se.fit</span>,</span>
<span>                                  x <span class="op">=</span> <span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">x</span>,</span>
<span>                                  y<span class="op">=</span> <span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                                  year <span class="op">=</span> <span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">year</span>,</span>
<span>                                  month <span class="op">=</span> <span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">month</span>,</span>
<span>                                  war<span class="op">=</span><span class="va">NDVI_mod_df</span><span class="op">$</span><span class="va">war</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Filter to current time period to allow comparison of baseline to 2022</span></span>
<span><span class="va">all_gam_war_pred_space_df</span> <span class="op">&lt;-</span> <span class="va">all_gam_war_pred_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">&lt;</span> <span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Space plot by month</span></span>
<span><span class="va">space_month_year_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">all_gam_war_pred_space_df</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, fill<span class="op">=</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, z<span class="op">=</span><span class="va">pred</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>, <span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">war</span><span class="op">~</span><span class="va">month</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">'NDVI'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">'Longitude'</span>, y<span class="op">=</span><span class="st">'Latitude'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="st">"none"</span>, colour<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Ukr_bnds</span>, alpha<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">'cm'</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Coordinate system already present. Adding new coordinate system, which will replace the existing one.</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">space_month_year_plot</span></span></code></pre></div>
<p><img src="Ukraine-NDVI-analysis_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We plot the partial effect of year on cropland NDVI in Ukrain with a
shaded ribbon denoting plus/minus the standard error from the
estimate.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot partial effect of year</span></span>
<span><span class="va">all_gam_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcViz/man/getViz.html" class="external-link">getViz</a></span><span class="op">(</span><span class="va">all_gam</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_gam_year_plot_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/mgcViz/man/sm.html" class="external-link">sm</a></span><span class="op">(</span><span class="va">all_gam_viz</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">fit</span></span>
<span></span>
<span><span class="va">Ukr_year_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_gam_year_plot_dat</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, ymin <span class="op">=</span> <span class="va">y</span><span class="op">-</span><span class="va">se</span>, ymax <span class="op">=</span> <span class="va">y</span><span class="op">+</span><span class="va">se</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2012</span>, <span class="fl">2022</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"NDVI"</span>, x <span class="op">=</span> <span class="st">"Year"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Ukr_year_plot</span></span></code></pre></div>
<p><img src="Ukraine-NDVI-analysis_files/figure-html/unnamed-chunk-9-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Wellington, M., Lawes, R., Kuhnert, P. (2022) Rapid monitoring of
crop growth, grain exports, and fire patterns in Ukraine, Nature Food,
Under Review.</p>
<p>Wood, S. N., Li, Z., Shaddick, G. &amp; Augustin, N. H. (2017)
Generalized Additive Models for Gigadata: Modeling the U.K. Black 166
Smoke Network Daily Data. J. Am. Stat. Assoc. 112, 1199–1210, DOI:
10.1080/01621459.2016.1195744.</p>
<p>Wood, S. N. (2006) Generalized additive models: an introduction with
R, Chapman and Hall/CRC.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Wellington.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
