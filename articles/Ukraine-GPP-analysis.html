<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="UkraineCrops">
<title>Ukraine GPP Analysis • UkraineCrops</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ukraine GPP Analysis">
<meta property="og:description" content="UkraineCrops">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">UkraineCrops</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Ukraine-GPP-analysis.html">Ukraine GPP Analysis</a>
    <a class="dropdown-item" href="../articles/Ukraine_ship_analysis.html">Ukraine Ship Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Ukraine GPP Analysis</h1>
                        <h4 data-toc-skip class="author">Michael
Wellington, Roger Lawes and Petra Kuhnert</h4>
            
            <h4 data-toc-skip class="date">4 August 2022</h4>
      
      
      <div class="d-none name"><code>Ukraine-GPP-analysis.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>The following script accompanies the paper by Wellington et
al. (2022) that explores crop production and grain exports in Ukraine.
This first vignette focuses on trends in crop production using Net
Primary Productivity (NPP).</p>
</div>
<div class="section level3">
<h3 id="trend-analysis">Trend Analysis<a class="anchor" aria-label="anchor" href="#trend-analysis"></a>
</h3>
</div>
<div class="section level2">
<h2 id="reading-in-relevant-datasets">Reading in relevant datasets<a class="anchor" aria-label="anchor" href="#reading-in-relevant-datasets"></a>
</h2>
<p>We load in NPP data clipped to Ukraine and load in the relevant shape
file. These datasets are also available in the <code>/data</code> and
<code>/inst/extdata</code> directories and can be read in using the
<code>readRDS</code> and <code>st_read</code> commands respectively.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mickwelli.github.io/Ukraine-crops/" class="external-link">UkraineCrops</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">GPP_mod_df</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Ukr_bnds</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Ukr_FAOSTAT</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fitting-the-generalised-additive-model-gam">Fitting the Generalised Additive Model (GAM)<a class="anchor" aria-label="anchor" href="#fitting-the-generalised-additive-model-gam"></a>
</h2>
<p>We fit a Generalised Additive Model (GAM) (Wood 2006) assuming a
Gaussian distribution for the response variable, NPP and include smooth
terms for year, season, space and relevant interactions, which consist
of season within year, and space and time.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_f</span> <span class="op">&lt;-</span> <span class="va">GPP</span> <span class="op">~</span>  </span>
<span>  <span class="co"># smooth term for year</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">year</span>, bs<span class="op">=</span><span class="st">"cr"</span>, k<span class="op">=</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># cyclic term for season</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">month</span>, bs<span class="op">=</span><span class="st">"cc"</span>, k<span class="op">=</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># smooth term for space</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, bs<span class="op">=</span><span class="st">'gp'</span>, k<span class="op">=</span><span class="fl">50</span><span class="op">)</span>  <span class="op">+</span>                </span>
<span>  <span class="co"># seasonal within year</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">month</span>, <span class="va">year</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cc"</span>, <span class="st">"cr"</span><span class="op">)</span>, k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># space x time</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">year</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gp"</span>, <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>     k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">12</span><span class="op">)</span>, m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p>We then add in the factor <code>inv</code> which allows us to
investigate a pre and post invasion effect.</p>
<p>We also explore a GAM structure that fits a term reflecting the pre
(2012-21) and post war (2022) periods. This term which we refer to as
<code>war</code> represents a binary variable where 1 indicates year
2022 when the war began.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_f_war</span> <span class="op">&lt;-</span> <span class="va">GPP</span> <span class="op">~</span>  </span>
<span>  <span class="co"># smooth term for year</span></span>
<span>  <span class="va">war</span> <span class="op">+</span> </span>
<span>  <span class="co"># cyclic term for season</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">month</span>, bs<span class="op">=</span><span class="st">"cc"</span>, k<span class="op">=</span><span class="fl">12</span>, by<span class="op">=</span><span class="va">war</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="co"># smooth term for space</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span>, bs<span class="op">=</span><span class="st">'gp'</span>, k<span class="op">=</span><span class="fl">50</span>, by<span class="op">=</span><span class="va">war</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># space x time</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">month</span>, d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, bs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gp"</span>, <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>     k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">12</span><span class="op">)</span>, m<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">2</span>, <span class="cn">NA</span><span class="op">)</span>, by<span class="op">=</span><span class="va">war</span><span class="op">)</span>  </span></code></pre></div>
<p>We now fit each model using the <code>mgcv</code> package in
<code>R</code> and store the results. To accommodate temporal
dependencies we fit a correlation term in each model that was the result
of an iterative process as outlined in Wood et al. (2017). The final
model fit for the invasion model is presented here from which we extract
effect direction and size.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run GAMs for large datasets</span></span>
<span><span class="va">all_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></span><span class="op">(</span><span class="va">all_f</span>, data<span class="op">=</span><span class="va">GPP_mod_df</span>, discrete<span class="op">=</span><span class="cn">TRUE</span>, nthreads<span class="op">=</span><span class="fl">8</span>, rho<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">all_gam_war</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam</a></span><span class="op">(</span><span class="va">all_f_war</span>, data<span class="op">=</span><span class="va">GPP_mod_df</span>, discrete<span class="op">=</span><span class="cn">TRUE</span>, nthreads<span class="op">=</span><span class="fl">8</span>, rho<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co"># Output shows effect of the invasion period on cropland GPP</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">all_gam_war</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: gaussian </span></span>
<span><span class="co">## Link function: identity </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## GPP ~ war + s(month, bs = "cc", k = 12, by = war) + s(x, y, bs = "gp", </span></span>
<span><span class="co">##     k = 50, by = war) + ti(x, y, month, d = c(2, 1), bs = c("gp", </span></span>
<span><span class="co">##     "cr"), k = c(50, 12), m = list(2, NA), by = war)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##                   Estimate Std. Error  t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)      191.09962    0.09495 2012.712   &lt;2e-16 ***</span></span>
<span><span class="co">## warPost-invasion  -1.65267    6.43545   -0.257    0.797    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                                    edf Ref.df         F p-value    </span></span>
<span><span class="co">## s(month):warPre-invasion         9.998  10.00 386158.12  &lt;2e-16 ***</span></span>
<span><span class="co">## s(month):warPost-invasion        8.992   9.00  29330.70  &lt;2e-16 ***</span></span>
<span><span class="co">## s(x,y):warPre-invasion          48.528  48.92   3357.00  &lt;2e-16 ***</span></span>
<span><span class="co">## s(x,y):warPost-invasion         44.154  45.40     16.74  &lt;2e-16 ***</span></span>
<span><span class="co">## ti(month,x,y):warPre-invasion  490.490 519.83    627.08  &lt;2e-16 ***</span></span>
<span><span class="co">## ti(month,x,y):warPost-invasion 340.912 388.60     89.06  &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.861   Deviance explained = 86.1%</span></span>
<span><span class="co">## fREML = 6.5579e+06  Scale est. = 2493.2    n = 1283803</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="model-checking">Model Checking<a class="anchor" aria-label="anchor" href="#model-checking"></a>
</h2>
<p>We examine the fit of the model and check for temporal and spatial
autocorrelation in the residuals. These diagnostics are examined below
and sufficiently account for correlation in the data with the given
model structure.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Temporal autocorrelation plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/check_resid.html" class="external-link">check_resid</a></span><span class="op">(</span><span class="va">all_gam</span>, ask<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-5-1.png" width="768" style="display: block; margin: auto;"><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-5-2.png" width="768" style="display: block; margin: auto;"><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-5-3.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Variogram for spatial autocorrelation</span></span>
<span><span class="va">resids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/residuals.gam.html" class="external-link">residuals.gam</a></span><span class="op">(</span><span class="va">all_gam</span><span class="op">)</span></span>
<span><span class="va">data_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>resids <span class="op">=</span> <span class="va">resids</span>, long <span class="op">=</span> <span class="va">GPP_mod_df</span><span class="op">$</span><span class="va">x</span>, lat <span class="op">=</span> <span class="va">GPP_mod_df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu">coordinates</span><span class="op">(</span><span class="va">data_pred</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">long</span><span class="op">+</span><span class="va">lat</span></span>
<span><span class="co"># Select a sample for compute efficiency  </span></span>
<span><span class="va">var_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gstat/man/variogram.html" class="external-link">variogram</a></span> <span class="op">(</span><span class="va">resids</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">data_pred</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_pred</span><span class="op">)</span>, <span class="fl">10000</span><span class="op">)</span>,<span class="op">]</span><span class="op">)</span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var_plot</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-5-4.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="investigating-trends-and-agreement-with-ground-data">Investigating trends and agreement with ground data<a class="anchor" aria-label="anchor" href="#investigating-trends-and-agreement-with-ground-data"></a>
</h2>
<p>We generate a summed effect of year plot, extract data from it, and
pass it to a ggplot2 object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_year_smplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/plot_smooth.html" class="external-link">plot_smooth</a></span><span class="op">(</span><span class="va">all_gam</span>, view<span class="op">=</span><span class="st">'year'</span>, rm.ranef <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary:</span></span>
<span><span class="co">##  * year : numeric predictor; with 30 values ranging from 2010.000000 to 2022.000000. </span></span>
<span><span class="co">##  * month : numeric predictor; set to the value(s): 7. </span></span>
<span><span class="co">##  * x : numeric predictor; set to the value(s): 31.7105295. </span></span>
<span><span class="co">##  * y : numeric predictor; set to the value(s): 48.9581829.</span></span></code></pre>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_year_sm_ggplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Ukr_year_smplot</span><span class="op">$</span><span class="va">fv</span><span class="op">$</span><span class="va">fit</span>,</span>
<span>                                           x<span class="op">=</span><span class="va">Ukr_year_smplot</span><span class="op">$</span><span class="va">fv</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Ukr_year_smplot</span><span class="op">$</span><span class="va">fv</span><span class="op">$</span><span class="va">year</span>, </span>
<span>                  ymax<span class="op">=</span> <span class="va">Ukr_year_smplot</span><span class="op">$</span><span class="va">fv</span><span class="op">$</span><span class="va">ul</span>, ymin<span class="op">=</span><span class="va">Ukr_year_smplot</span><span class="op">$</span><span class="va">fv</span><span class="op">$</span><span class="va">ll</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">2022</span>,<span class="fl">1</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2009.5</span>,<span class="fl">2022</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">550</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Year"</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">'GPP'</span><span class="op">~</span><span class="op">(</span><span class="va">kgC</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We will also generate a bar plot showing the total crop production
tonnage in Ukraine from 2010 to 2020 and the crops comprising it. These
data were taken from the <a href="https://www.fao.org/faostat/en/" class="external-link">FAOSAT</a> database.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_grain_dat</span> <span class="op">&lt;-</span> <span class="va">Ukr_FAOSTAT</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Element</span> <span class="op">==</span> <span class="st">"Production"</span><span class="op">)</span></span>
<span><span class="va">Ukr_real_grain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Ukr_grain_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Item</span>, y<span class="op">=</span><span class="va">Value</span>, x<span class="op">=</span><span class="va">Year</span><span class="op">)</span>, </span>
<span>                                     position<span class="op">=</span><span class="st">"stack"</span>, stat<span class="op">=</span><span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_npg.html" class="external-link">scale_fill_npg</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">'Crop Type'</span>, y<span class="op">=</span> <span class="st">'Total tonnes produced'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/unit_format.html" class="external-link">unit_format</a></span><span class="op">(</span>unit <span class="op">=</span> <span class="st">"M"</span>, scale <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2010</span>,<span class="fl">2021</span>, <span class="fl">1</span><span class="op">)</span>, limit<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>, <span class="fl">2022</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Before we format the final plot, we’ll perform a correlation test to
check agreement between total crop production from FAOSTAT data and our
NPP model. First of all, we extract the prediction terms for the year
effect from our GAM.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_annual_preds_terms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">all_gam</span>, type<span class="op">=</span><span class="st">"iterms"</span>,  <span class="co">## Predict without new data</span></span>
<span>                                 se.fit<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Ukr_annual_preds_terms</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     s(year)  s(month)     s(x,y) ti(month,year) ti(year,x,y)</span></span>
<span><span class="co">## 1 -7.206782 -166.4977 -14.672125       16.72331   -27.269094</span></span>
<span><span class="co">## 2 -7.206782 -166.4977 -13.961324       16.72331   -23.459930</span></span>
<span><span class="co">## 3 -7.206782 -166.4977  -9.994319       16.72331    -6.882217</span></span>
<span><span class="co">## 4 -7.206782 -166.4977 -10.362108       16.72331    -9.312854</span></span>
<span><span class="co">## 5 -7.206782 -166.4977 -10.624894       16.72331   -11.004132</span></span>
<span><span class="co">## 6 -7.206782 -166.4977 -14.556385       16.72331   -18.299855</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_annual_preds_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Ukr_annual_preds_terms</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">Ukr_annual_preds_fit</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="va">GPP_mod_df</span><span class="op">$</span><span class="va">year</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Ukr_annual_preds_fit</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'year_hat'</span>, <span class="st">'month_hat'</span>, <span class="st">'space_hat'</span>, <span class="st">'yxm_hat'</span>, <span class="st">'yxs_hat'</span>, <span class="st">'year'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Ukr_annual_terms</span> <span class="op">&lt;-</span> <span class="va">Ukr_annual_preds_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>year_term<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">year_hat</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span><span class="op">&lt;</span><span class="fl">2021</span><span class="op">)</span></span></code></pre></div>
<p>We’ll also summarise the crop production data and create a dataframe
prior to the correlation test.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_grainprod_annual</span> <span class="op">&lt;-</span> <span class="va">Ukr_grain_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">group_by</span><span class="op">(</span><span class="va">Year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Element</span> <span class="op">==</span><span class="st">"Production"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>tonnes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Value</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Ukr_corr_df</span> <span class="op">&lt;-</span> <span class="fu">bind_cols</span><span class="op">(</span><span class="va">Ukr_grainprod_annual</span><span class="op">$</span><span class="va">tonnes</span>, <span class="va">Ukr_annual_terms</span><span class="op">$</span><span class="va">year_term</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## New names:</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...1`</span></span>
<span><span class="co">## <span style="color: #00BBBB;">•</span> `` -&gt; `...2`</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Ukr_corr_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RealTonnes"</span>, <span class="st">"YearTerms"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s inspect the relationship to see if it is linear before formally
conducting the test.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggscatter</span><span class="op">(</span>data <span class="op">=</span> <span class="va">Ukr_corr_df</span>, x <span class="op">=</span> <span class="st">'YearTerms'</span>, y <span class="op">=</span> <span class="st">'RealTonnes'</span>, </span>
<span>          add <span class="op">=</span> <span class="st">"reg.line"</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          cor.coef <span class="op">=</span> <span class="cn">TRUE</span>, cor.method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>          xlab <span class="op">=</span> <span class="st">"Predicted GPP term"</span>, ylab <span class="op">=</span> <span class="st">"Real T crop produced"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula 'y ~ x'</span></span></code></pre>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-10-1.png" width="768" style="display: block; margin: auto;"></p>
<p>Check both columns for normality and conduct a correlation test.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/shapiro.test.html" class="external-link">shapiro.test</a></span><span class="op">(</span><span class="va">Ukr_grainprod_annual</span><span class="op">$</span><span class="va">tonnes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Shapiro-Wilk normality test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  Ukr_grainprod_annual$tonnes</span></span>
<span><span class="co">## W = 0.91013, p-value = 0.2447</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/shapiro.test.html" class="external-link">shapiro.test</a></span><span class="op">(</span><span class="va">Ukr_annual_terms</span><span class="op">$</span><span class="va">year_term</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Shapiro-Wilk normality test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  Ukr_annual_terms$year_term</span></span>
<span><span class="co">## W = 0.93546, p-value = 0.4687</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">Ukr_grainprod_annual</span><span class="op">$</span><span class="va">tonnes</span>, <span class="va">Ukr_annual_terms</span><span class="op">$</span><span class="va">year_term</span>, method<span class="op">=</span><span class="st">"pearson"</span>, alternative<span class="op">=</span><span class="st">"greater"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Pearson's product-moment correlation</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  Ukr_grainprod_annual$tonnes and Ukr_annual_terms$year_term</span></span>
<span><span class="co">## t = 2.7268, df = 9, p-value = 0.01167</span></span>
<span><span class="co">## alternative hypothesis: true correlation is greater than 0</span></span>
<span><span class="co">## 95 percent confidence interval:</span></span>
<span><span class="co">##  0.2297834 1.0000000</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##       cor </span></span>
<span><span class="co">## 0.6726155</span></span></code></pre>
<p>Finally, we can plot the summed effect of year alongside the real
production data.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_realagree</span> <span class="op">&lt;-</span> <span class="fu">ggarrange</span><span class="op">(</span><span class="va">Ukr_year_sm_ggplot</span>,<span class="va">Ukr_real_grain</span>, </span>
<span>          labels <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>          ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>          align <span class="op">=</span> <span class="st">"hv"</span>,</span>
<span>          font.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, color <span class="op">=</span> <span class="st">"black"</span>, face <span class="op">=</span> <span class="st">"bold"</span>, family <span class="op">=</span> <span class="cn">NULL</span>, position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Ukr_realagree</span></span></code></pre></div>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="monthly-effect-and-crop-calendar">Monthly effect and crop calendar<a class="anchor" aria-label="anchor" href="#monthly-effect-and-crop-calendar"></a>
</h3>
<p>We’d also like to inspect the effect of the month on cropland NPP pre
and post invasion. We can do this with the plot_smooth function again.
The code chunk below also produces a crop calendar adapted from the <a href="https://www.fao.org/giews/countrybrief/country/UKR/pdf/UKR.pdf" class="external-link">UN
FAO GIEWS Factsheet</a>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">month_war_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/plot_smooth.html" class="external-link">plot_smooth</a></span><span class="op">(</span><span class="va">all_gam_war</span>, view<span class="op">=</span><span class="st">"month"</span>,plot_all<span class="op">=</span><span class="st">"war"</span>, rm.ranef <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary:</span></span>
<span><span class="co">##  * war : factor; set to the value(s): Post-invasion, Pre-invasion. </span></span>
<span><span class="co">##  * month : numeric predictor; with 30 values ranging from 1.000000 to 12.000000. </span></span>
<span><span class="co">##  * x : numeric predictor; set to the value(s): 31.7105295. </span></span>
<span><span class="co">##  * y : numeric predictor; set to the value(s): 48.9581829.</span></span></code></pre>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">month_war_plot_dat</span> <span class="op">&lt;-</span> <span class="va">month_war_plot</span><span class="op">$</span><span class="va">fv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">select</span><span class="op">(</span><span class="va">war</span>, <span class="va">month</span>, <span class="va">fit</span>, <span class="va">ll</span>, <span class="va">ul</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">war</span><span class="op">==</span><span class="st">"Pre-invasion"</span> <span class="op">|</span> <span class="va">month</span><span class="op">&lt;</span><span class="fl">12</span><span class="op">&amp;</span><span class="va">month</span><span class="op">&gt;</span><span class="fl">2.8</span><span class="op">)</span></span>
<span><span class="va">month_war_plot_dat</span><span class="op">$</span><span class="va">month_abb</span> <span class="op">&lt;-</span> <span class="va">month.abb</span><span class="op">[</span><span class="va">month_war_plot_dat</span><span class="op">$</span><span class="va">month</span><span class="op">]</span></span>
<span></span>
<span><span class="va">month_comp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">month_war_plot_dat</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">month</span>, y<span class="op">=</span><span class="va">fit</span>, col<span class="op">=</span><span class="va">war</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">ll</span>, ymax<span class="op">=</span><span class="va">ul</span>, x<span class="op">=</span><span class="va">month</span>, fill<span class="op">=</span><span class="va">war</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, </span>
<span>        labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Jan'</span>, <span class="st">'Feb'</span>, <span class="st">'Mar'</span>, <span class="st">'Apr'</span>, <span class="st">'May'</span>, <span class="st">'Jun'</span>, <span class="st">'Jul'</span>, <span class="st">'Aug'</span>, <span class="st">'Sep'</span>, <span class="st">'Oct'</span>, <span class="st">'Nov'</span>, <span class="st">'Dec'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/bquote.html" class="external-link">bquote</a></span><span class="op">(</span><span class="st">'NPP'</span><span class="op">~</span><span class="op">(</span><span class="va">kgC</span><span class="op">/</span><span class="va">m</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, x<span class="op">=</span><span class="st">'Month'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://nanx.me/ggsci/reference/scale_npg.html" class="external-link">scale_fill_npg</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sowing"</span> <span class="op">=</span> <span class="st">"brown"</span>, <span class="st">"Growing"</span> <span class="op">=</span> <span class="st">"darkgreen"</span>, <span class="st">"Harvest"</span> <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Ukr_crop_cal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Winter Cereals"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-01-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-30"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Growing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Winter Cereals"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-30"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-08-20"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Harvest"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Winter Cereals"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-09-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-30"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Sowing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Winter Cereals"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-30"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-12-31"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Growing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Maize"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-05-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-10"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Sowing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Maize"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-10"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-01"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Growing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Maize"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-11-30"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Harvest"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Sunflower"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-04-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Sowing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Sunflower"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-08-31"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Growing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Sunflower"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-08-31"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-30"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Harvest"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Rapeseed"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-01-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-30"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Growing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Rapeseed"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-30"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-08-31"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Harvest"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Rapeseed"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-08-31"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-01"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Sowing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Rapeseed"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-12-31"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Growing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Potatoes"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-04-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Sowing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Potatoes"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-06-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-09-01"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Growing"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_linerange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"Potatoes"</span>, ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-09-01"</span><span class="op">)</span>, ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-10-31"</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"Harvest"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_y_date</a></span><span class="op">(</span>lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2013-12-31"</span><span class="op">)</span><span class="op">)</span>,breaks<span class="op">=</span><span class="fu"><a href="https://scales.r-lib.org/reference/date_breaks.html" class="external-link">date_breaks</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"1 month"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/date_format.html" class="external-link">date_format</a></span><span class="op">(</span><span class="st">"%b"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">"Month"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">colors</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can combine the plots.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Ukr_cropplots</span> <span class="op">&lt;-</span> <span class="fu">ggdraw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">draw_plot</span><span class="op">(</span><span class="va">month_comp_plot</span>, x<span class="op">=</span><span class="fl">0.075</span>, y<span class="op">=</span><span class="fl">0.5</span>, width<span class="op">=</span><span class="fl">0.91</span>, height<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">draw_plot</span><span class="op">(</span><span class="va">Ukr_crop_cal</span>, x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, width<span class="op">=</span><span class="fl">1</span>, height<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"white"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Ukr_cropplots</span></span></code></pre></div>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-14-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="generate-a-spatial-plot-with-uncertainty">Generate a spatial plot with uncertainty<a class="anchor" aria-label="anchor" href="#generate-a-spatial-plot-with-uncertainty"></a>
</h2>
<p>We will use the Vizumap package to compare the distribution of NPP
pre and post invasion and visualise uncertainty associated with the
estimate (Lucchesi, 2021). First, we extract data from the GAMs.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">space_nowar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/fvisgam.html" class="external-link">fvisgam</a></span><span class="op">(</span><span class="va">all_gam_war</span>, view <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, </span>
<span>                       cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>war <span class="op">=</span> <span class="st">"Pre-invasion"</span><span class="op">)</span>,</span>
<span>                       main <span class="op">=</span> <span class="st">"Pre-invasion"</span>, rm.ranef <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                       n.grid<span class="op">=</span><span class="fl">100</span>,</span>
<span>                       too.far<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary:</span></span>
<span><span class="co">##  * war : factor; set to the value(s): Pre-invasion. </span></span>
<span><span class="co">##  * month : numeric predictor; set to the value(s): 7. </span></span>
<span><span class="co">##  * x : numeric predictor; with 100 values ranging from 22.188388 to 40.154693. </span></span>
<span><span class="co">##  * y : numeric predictor; with 100 values ranging from 44.466606 to 52.371781. </span></span>
<span><span class="co">##  * NOTE : The following random effects columns are canceled: s(month):warPre-invasion,s(month):warPost-invasion</span></span>
<span><span class="co">## </span></span></code></pre>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-15-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract data for plotting spatial term </span></span>
<span><span class="va">space_nowar_dat</span> <span class="op">&lt;-</span> <span class="va">space_nowar</span><span class="op">$</span><span class="va">fv</span></span>
<span><span class="va">space_nowar_dat</span><span class="op">$</span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="va">space_nowar_dat</span><span class="op">$</span><span class="va">CI</span><span class="op">/</span><span class="fl">1.96</span></span>
<span></span>
<span><span class="co"># Rpt for war</span></span>
<span><span class="va">space_war</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/fvisgam.html" class="external-link">fvisgam</a></span><span class="op">(</span><span class="va">all_gam_war</span>, view <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, </span>
<span>                       cond <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>war <span class="op">=</span> <span class="st">"Post-invasion"</span><span class="op">)</span>,</span>
<span>                       main <span class="op">=</span> <span class="st">"Post-invasion"</span>, rm.ranef <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                       n.grid<span class="op">=</span><span class="fl">100</span>,</span>
<span>                       too.far<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Summary:</span></span>
<span><span class="co">##  * war : factor; set to the value(s): Post-invasion. </span></span>
<span><span class="co">##  * month : numeric predictor; set to the value(s): 7. </span></span>
<span><span class="co">##  * x : numeric predictor; with 100 values ranging from 22.188388 to 40.154693. </span></span>
<span><span class="co">##  * y : numeric predictor; with 100 values ranging from 44.466606 to 52.371781. </span></span>
<span><span class="co">##  * NOTE : The following random effects columns are canceled: s(month):warPre-invasion,s(month):warPost-invasion</span></span>
<span><span class="co">## </span></span></code></pre>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-15-2.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract data for plotting spatial term</span></span>
<span><span class="va">space_war_dat</span> <span class="op">&lt;-</span> <span class="va">space_war</span><span class="op">$</span><span class="va">fv</span></span>
<span><span class="va">space_war_dat</span><span class="op">$</span><span class="va">SE</span> <span class="op">&lt;-</span> <span class="va">space_war_dat</span><span class="op">$</span><span class="va">CI</span><span class="op">/</span><span class="fl">1.96</span></span></code></pre></div>
<p>Next, we use Vizumap functions to build a palette and colour key.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create palette</span></span>
<span><span class="va">npp_pal</span> <span class="op">&lt;-</span> <span class="fu">build_palette</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"usr"</span>, </span>
<span>                          colrange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chartreuse4"</span>, <span class="st">"darkblue"</span><span class="op">)</span>, </span>
<span>                                          difC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">view</span><span class="op">(</span><span class="va">npp_pal</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creating df for Vizumap plotting</span></span>
<span><span class="va">space_npp_dat</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">space_nowar_dat</span>, <span class="va">space_war_dat</span><span class="op">)</span></span>
<span><span class="va">npp_war_df</span> <span class="op">&lt;-</span> <span class="fu">read.uv</span><span class="op">(</span>data <span class="op">=</span> <span class="va">space_npp_dat</span>, estimate <span class="op">=</span> <span class="st">"fit"</span>, </span>
<span>                       error <span class="op">=</span> <span class="st">"SE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">npp_war_df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>,<span class="fl">6</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Estimate"</span>, <span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># build key</span></span>
<span><span class="va">UKey</span> <span class="op">&lt;-</span> <span class="fu">build_bkey</span><span class="op">(</span>data <span class="op">=</span> <span class="va">npp_war_df</span>, terciles <span class="op">=</span> <span class="cn">T</span>, palette <span class="op">=</span> <span class="va">npp_pal</span><span class="op">)</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu">view</span><span class="op">(</span><span class="va">UKey</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">nppBivMap</span> <span class="op">&lt;-</span> <span class="fu">build_bmap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">npp_war_df</span>, terciles <span class="op">=</span> <span class="cn">T</span>, </span>
<span>                           palette <span class="op">=</span> <span class="va">npp_pal</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can build the Vizumap plot.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="va">nppBivMap</span></span>
<span><span class="va">obj_cropped</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/exclude.too.far.html" class="external-link">exclude.too.far</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">output_data</span><span class="op">$</span><span class="va">long</span>, <span class="va">obj</span><span class="op">$</span><span class="va">output_data</span><span class="op">$</span><span class="va">lat</span>, </span>
<span>                               <span class="va">npp_mod_df</span><span class="op">$</span><span class="va">x</span>, <span class="va">npp_mod_df</span><span class="op">$</span><span class="va">y</span>, dist<span class="op">=</span><span class="fl">0.015</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">output_data</span><span class="op">[</span><span class="op">!</span><span class="va">obj_cropped</span>,<span class="op">]</span>, </span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, fill <span class="op">=</span> <span class="va">hex_code</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">war</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_identity.html" class="external-link">scale_fill_identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Ukr_bnds</span>, alpha<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Coordinate system already present. Adding new coordinate system, which will replace the existing one.</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mk</span> <span class="op">&lt;-</span> <span class="fu">ggdraw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">draw_plot</span><span class="op">(</span><span class="va">m</span>, x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span>, width<span class="op">=</span><span class="fl">0.6</span>, height<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">draw_plot</span><span class="op">(</span><span class="va">k</span>, x<span class="op">=</span><span class="fl">0.6</span>, y<span class="op">=</span><span class="fl">0</span>, width <span class="op">=</span> <span class="fl">0.4</span>, height<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"white"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mk</span></span></code></pre></div>
<p><img src="Ukraine-GPP-analysis_files/figure-html/unnamed-chunk-17-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Lucchesi, L., Kuhnert, P., Wikle, C. (2021). Vizumap: an R package
for visualising uncertainty in spatial data. Journal of Open Source
Software, 6(59), 2409, <a href="https://doi.org/10.21105/joss.02409" class="external-link uri">https://doi.org/10.21105/joss.02409</a></p>
<p>Wellington, M., Lawes, R., Kuhnert, P. (2022) Rapid monitoring of
crop growth, grain exports, and fire patterns in Ukraine.</p>
<p>Wood, S. N., Li, Z., Shaddick, G. &amp; Augustin, N. H. (2017)
Generalized Additive Models for Gigadata: Modeling the U.K. Black 166
Smoke Network Daily Data. J. Am. Stat. Assoc. 112, 1199–1210, DOI:
10.1080/01621459.2016.1195744. Wood, S. N., Li, Z., Shaddick, G. &amp;
Augustin, N. H. (2017) Generalized Additive Models for Gigadata:
Modeling the U.K. Black 166 Smoke Network Daily Data. J. Am. Stat.
Assoc. 112, 1199–1210, DOI: 10.1080/01621459.2016.1195744.</p>
<p>Wood, S. N. (2006) Generalized additive models: an introduction with
R, Chapman and Hall/CRC.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Wellington.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
