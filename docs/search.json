[{"path":"/articles/Ukraine-NDVI-analysis.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"Ukraine NDVI Analysis","text":"following script accompanies paper Wellington et al. (2022) explores crop growth, grain exports fire patterns Ukraine. first vignette focuses trends crop growth using NDVI.","code":""},{"path":[]},{"path":"/articles/Ukraine-NDVI-analysis.html","id":"reading-in-relevant-datasets","dir":"Articles","previous_headings":"","what":"Reading in relevant datasets","title":"Ukraine NDVI Analysis","text":"load NDVI data clipped Ukraine load relevant shape file. datasets also available /data /inst/extdata directories can read using readRDS st_read commands respectively.","code":"library(UkraineCrops)  data(NDVI_mod_df) data(Ukr_bnds)"},{"path":"/articles/Ukraine-NDVI-analysis.html","id":"creating-a-pre-and-post-invasion-term","dir":"Articles","previous_headings":"","what":"Creating a pre and post-invasion term","title":"Ukraine NDVI Analysis","text":"NDVI_mod_df includes war term pre post 2022 calendar years also need create pre post-invasion term reflected date invasion (24th February 2022).","code":"# Allocate factor for invasion NDVI_mod_df$inv <- as.factor(if_else(NDVI_mod_df$date < '2022-02-24', \"0\", \"1\"))"},{"path":"/articles/Ukraine-NDVI-analysis.html","id":"fitting-the-generalised-additive-model-gam","dir":"Articles","previous_headings":"","what":"Fitting the Generalised Additive Model (GAM)","title":"Ukraine NDVI Analysis","text":"fit Generalised Additive Model (GAM) (Wood 2006) assuming Gaussian distribution response variable, NDVI include smooth terms year, season, space relevant interactions, consist season within year, space time. add factor inv allows us investigate pre post invasion effect. also explore GAM structure fits term reflecting pre (2012-21) post war (2022) periods. term refer war represents binary variable 1 indicates year 2022 war began. now fit model using mgcv package R store results. accommodate temporal dependencies fit correlation term model result iterative process outlined Wood et al. (2017). final model fits presented . model takes minutes run.","code":"# Setting up the GAM structure with key smoothers for trend terms all_f <- NDVI ~     # smooth term for year   s(year, bs=\"cr\", k=11) +    # cyclic term for season   s(month, bs=\"cc\", k=12) +     # smooth term for space   s(x,y, bs='gp', k=50)  +               # seasonal within year   ti(month, year, bs = c(\"cc\", \"cr\"), k = c(12,11)) +     # space x time   ti(x, y, year, d = c(2, 1), bs = c(\"gp\", \"cr\"),       k = c(50,11), m=list(2, NA)) # Setting up the GAM structure with an added term reflecting # the start of the invasion all_f_inv <- NDVI ~     # factor for pre/ post-invasion   inv +    # cyclic term for season   s(month, bs=\"cc\", k=12, by=inv) +     # smooth term for space   s(x,y, bs='gp', k=50, by=inv) +   # space x time   ti(x, y, month, d = c(2, 1), bs = c(\"gp\", \"cr\"),       k = c(50,12), m=list(2, NA), by=inv) all_f_war <- NDVI ~     # factor for pre/ post-2022   war +    # cyclic term for season   s(month, bs=\"cc\", k=12, by=war) +     # smooth term for space   s(x,y, bs='gp', k=50, by=war) +   # space x time   ti(x, y, month, d = c(2, 1), bs = c(\"gp\", \"cr\"),       k = c(50,12), m=list(2, NA), by=war) # Run GAMs for large datasets all_gam <- bam(all_f, data=NDVI_mod_df, discrete=TRUE, nthreads=8, rho=0.8) all_gam_war <- bam(all_f_war, data=NDVI_mod_df, discrete=TRUE, nthreads=8, rho=0.6) all_gam_inv <- bam(all_f_inv, data=NDVI_mod_df, discrete=TRUE, nthreads=8, rho=0.6)  # Output shows effect of the invasion on cropland NDVI summary(all_gam_inv) ##  ## Family: gaussian  ## Link function: identity  ##  ## Formula: ## NDVI ~ inv + s(month, bs = \"cc\", k = 12, by = inv) + s(x, y,  ##     bs = \"gp\", k = 50, by = inv) + ti(x, y, month, d = c(2, 1),  ##     bs = c(\"gp\", \"cr\"), k = c(50, 12), m = list(2, NA), by = inv) ##  ## Parametric coefficients: ##             Estimate Std. Error  t value Pr(>|t|)     ## (Intercept) 4378.975      2.932 1493.446   <2e-16 *** ## inv1         -11.099    982.597   -0.011    0.991     ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##                        edf Ref.df         F  p-value     ## s(month):inv0        9.990  10.00 33993.699  < 2e-16 *** ## s(month):inv1        2.983   4.00  1617.662  < 2e-16 *** ## s(x,y):inv0         48.260  48.83  1412.879  < 2e-16 *** ## s(x,y):inv1         33.003  36.09     1.967 0.000487 *** ## ti(month,x,y):inv0 376.214 429.05   127.888  < 2e-16 *** ## ti(month,x,y):inv1  55.979  72.09     8.046  < 2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.716   Deviance explained = 71.6% ## fREML = 3.0937e+06  Scale est. = 7.7897e+05  n = 387617"},{"path":"/articles/Ukraine-NDVI-analysis.html","id":"model-checking","dir":"Articles","previous_headings":"","what":"Model Checking","title":"Ukraine NDVI Analysis","text":"examine fit model check temporal spatial autocorrelation residuals. diagnostics examined sufficiently account correlation data given model structure.","code":"# Temporal autocorrelation plot resids <- residuals.gam(all_gam_inv) acf_plot_ar <- acf(resids, type = \"correlation\")  plot(acf_plot_ar) # Variogram for spatial autocorrelation data_pred <- data.frame(resids = resids, long = NDVI_mod_df$x, lat = NDVI_mod_df$y) coordinates(data_pred) <- ~long+lat # Select a sample for compute efficiency   var_plot <- variogram (resids ~ 1, data = data_pred[sample(1:nrow(data_pred), 10000),])   plot(var_plot)"},{"path":"/articles/Ukraine-NDVI-analysis.html","id":"investigating-key-trends","dir":"Articles","previous_headings":"","what":"Investigating Key Trends","title":"Ukraine NDVI Analysis","text":"obtain NDVI predictions model produce maps comparing baseline period 2012-2021 (top row) 2022 (bottom row) per Figure 2 Wellington et al. (2022). (Note takes minutes run)  plot partial effect year cropland NDVI Ukrain shaded ribbon denoting plus/minus standard error estimate.","code":"# Get predictions for plotting all_gam_war_pred <- predict(all_gam_war, se=TRUE)  all_gam_war_pred_df <- data.frame(pred = all_gam_war_pred$fit,                                   pred_se = all_gam_war_pred$se.fit,                                   x = NDVI_mod_df$x,                                   y= NDVI_mod_df$y,                                   year = NDVI_mod_df$year,                                   month = NDVI_mod_df$month,                                   war=NDVI_mod_df$war)   # Filter to current time period to allow comparison of baseline to 2022 all_gam_war_pred_space_df <- all_gam_war_pred_df %>% filter(month < 7)  # Space plot by month space_month_year_plot <- ggplot(data=all_gam_war_pred_space_df) + geom_tile(aes(x=x, y=y, fill=pred)) +    geom_contour(aes(x=x, y=y, z=pred, col=\"red\"), )  + theme_bw() + facet_grid(war~month) +   scale_fill_viridis_c(name='NDVI') + coord_equal() +   labs(x='Longitude', y='Latitude') + guides(alpha=\"none\", colour=\"none\") + geom_sf(data=Ukr_bnds, alpha=0) +   theme(legend.key.size = unit(1, 'cm'), legend.position = \"bottom\") ## Coordinate system already present. Adding new coordinate system, which will replace the existing one. space_month_year_plot # Plot partial effect of year all_gam_viz <- getViz(all_gam)  all_gam_year_plot_dat <- plot(sm(all_gam_viz, 1))$data$fit  Ukr_year_plot <- ggplot(data = all_gam_year_plot_dat) +    geom_line(aes(x = x, y = y)) +   geom_ribbon(aes(x = x, ymin = y-se, ymax = y+se), alpha = 0.2) +    theme_bw() +   scale_x_continuous(breaks = seq(2012, 2022,1)) +   labs(y = \"NDVI\", x = \"Year\")  Ukr_year_plot"},{"path":"/articles/Ukraine-NDVI-analysis.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"Ukraine NDVI Analysis","text":"Wellington, M., Lawes, R., Kuhnert, P. (2022) Rapid monitoring crop growth, grain exports, fire patterns Ukraine, Nature Food, Review. Wood, S. N., Li, Z., Shaddick, G. & Augustin, N. H. (2017) Generalized Additive Models Gigadata: Modeling U.K. Black 166 Smoke Network Daily Data. J. . Stat. Assoc. 112, 1199–1210, DOI: 10.1080/01621459.2016.1195744. Wood, S. N. (2006) Generalized additive models: introduction R, Chapman Hall/CRC.","code":""},{"path":"/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Michael Wellington. Author, maintainer. Petra Kuhnert. Contributor, thesis advisor. Roger Lawes. Thesis advisor.","code":""},{"path":"/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Wellington M (2022). UkraineCrops: Ukraine-crop Analysis. R package version 0.9.0.","code":"@Manual{,   title = {UkraineCrops: Ukraine-crop Analysis},   author = {Michael Wellington},   year = {2022},   note = {R package version 0.9.0}, }"},{"path":[]},{"path":"/index.html","id":"code-and-data-used-to-analyse-ukraine-grain-supply-in-2022","dir":"","previous_headings":"","what":"Code and data used to analyse Ukraine grain supply in 2022.","title":"Ukraine-crop Analysis","text":"repo contains data code used analyse Ukraine grain supply, except cargo shipping data large. data can downloaded https://www.emodnet-humanactivities.eu/view-data.php .tif format. script used plot cargo shipping data included .","code":""},{"path":"/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Ukraine-crop Analysis","text":"can install UkraineCrops package using command .","code":"remotes::install_github(repo = \"mickwelli/UkraineCrops\", build_vignettes = TRUE)"},{"path":"/reference/NDVI_mod_df.html","id":null,"dir":"Reference","previous_headings":"","what":"NDVI_mod_df — NDVI_mod_df","title":"NDVI_mod_df — NDVI_mod_df","text":"NDVI MODIS data represented data frame extracted 1st January 2012 11th July 2022.","code":""},{"path":"/reference/NDVI_mod_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"NDVI_mod_df — NDVI_mod_df","text":"","code":"NDVI_mod_df"},{"path":"/reference/NDVI_mod_df.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"NDVI_mod_df — NDVI_mod_df","text":"data frame comprising 387617 rows 8 columns. date date NDVI capture x longitude y latitude NDVI Normalised Difference Vegetation Index year year NDVI captured month month NDVI captured day day month NDVI captured war factor representing pre (2012-2021) post (2022) war period","code":""},{"path":"/reference/Ukr_bnds.html","id":null,"dir":"Reference","previous_headings":"","what":"Ukr_bnds — Ukr_bnds","title":"Ukr_bnds — Ukr_bnds","text":"Ukraine shape file","code":""},{"path":"/reference/Ukr_bnds.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Ukr_bnds — Ukr_bnds","text":"","code":"Ukr_bnds"},{"path":"/reference/Ukr_bnds.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Ukr_bnds — Ukr_bnds","text":"`sf` object containing Ukraine border.","code":""}]
